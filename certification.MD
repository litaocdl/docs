
## Certification 

### Public key algorithm 

Currently there are three public key algorithm in popular. `RSA public key` `DSA Public key` and `ECDSA Public key`. 
openssl provides ways to generate those different public keys in command line 

#### `RSA public key`

 RSA stands for `Rivest, Shamir and Adelman`, which is most popular public-key algorithm, it could be used for key-exchange (encrypt data) and sign data. since rsa used for key-exchange, the compromise of a private key can be used to decrypt any previously traffic, it is recommended to use `perfect forward secrecy` afforded by Diffe-Hellman key exchange. 
 
 `Algorithm` There exists two numbers `e` and `d` which could make for a given m
 
             ![](https://github.com/litaocdl/docs/blob/master/pics/rsa.png)
 
 `public key` is composed with e and n
 `private key` is componsed with d and n, for rsa private key (PEM),e is also included. 
 
  openssl sub commands
  
  `openssl genrsa`: gen rsa private key
  `openssl rsa`: handle with rsa keys
  
 The following commands could be used to generate a RSA private key in PEM format. this PEM format is in RSA Private key format which contains the public key modulus. 
 
 ```
 openssl genrsa -out key.pem 2048
 ```
 
 to check the content of the `key.pem` file. the `-noout` flag indicates not output the private key content. from the output, we can see this pem file contains both private key and public key.
 
 ```
 openssl rsa -text -in key.pem -noout
 ===
 output:
          version           Version,
          modulus           INTEGER,  -- n
          publicExponent    INTEGER,  -- e
          privateExponent   INTEGER,  -- d
          prime1            INTEGER,  -- p
          prime2            INTEGER,  -- q
          exponent1         INTEGER,  -- d mod (p-1)
          exponent2         INTEGER,  -- d mod (q-1)
          coefficient       INTEGER,  -- (inverse of q) mod p
          otherPrimeInfos   OtherPrimeInfos OPTIONAL
 
 ```
 
 to retrieve the rsa public key from the key.pem out, we can issue 
 ```
 openssl rsa -in key.pem -pubout -out key.pub
 ```
 
 to check the public key content,we can issue
 ```
 openssl rsa -text -pubin -in key.pub -noout
 ==
 output:
   modulus           INTEGER,  -- n
   publicExponent    INTEGER   -- e
 
 ```
 
 To check if two key file are related, we can check the n `modulus` contains in the key file is equals or not
 
 ```
 openssl rsa -pubin -in key.pub -modulus -noout | openssl md5
 openssl rsa -in key.pem -modulus -noout | openssl md5
 
 ```
 [reference rfc3447](https://tools.ietf.org/html/rfc3447#appendix-A.1.1)
 [reference public key](https://commandlinefanatic.com/cgi-bin/showarticle.cgi?article=art054)
 
 
 #### `DSA public key`
 
 DSA: Digital Signature Algorithm
 
 `Algorithm`
 For given three numbers g, p and q, there are a pair of number x and y, which could make 
            ![](https://github.com/litaocdl/docs/blob/master/pics/dsa.png)
 q is generated by g and p.
 `public key`: y
 `private key`: x
 
 openssl sub commands
 
 `openssl dsaparam`: gen dsa params. 
 `openssl gendsa`: gen dsa private key
 `openssl dsa` : handle with dsa keys
 
 The following command is used to generate dsa public key. as the above algorithm, dsa need a param which composed with 
 g,p and q, so to generate dsa public/private key, we need first generate the dsa params. 
 
 Generate dsaparam `dsa_param.pem`
 
 ```
 openssl dsaparam -out dsa_param.pem 1024
 
 we can see the content of dsa_param.pem
 
 openssl dsaparam -in dsa_param.pem -text -noout
 ==
 output
 P: xxx
 Q: xxx
 G: xxx
 ```
 
 Use `dsa_param.pem` to generate dsa key: `dsa_priv.pem`
 
 ```
 openssl gendsa dsa_param.pem -out dsa_priv.pem
 
 we can check the contenxt of dsa_priv.pem, we can see the dsa private key contains both private and public
 key, samilar with rsa keys 
 
 openssl dsa -in dsa_priv.pem -text -noout -modulus
 ==
 output 
 priv:
 pub:
 P:
 Q:
 G:
 ```
 
 The above two steps could be combine together using `-genkey` of `dsaparam`
 ```
 openssl dsaparam -genkey -out dsa_priv.pem
 ```
 
 Extract public key from dsa private key
 
 ```
 openssl dsa -in dsa_priv.pem -pubout -out dsa_pub.pem
 
 check the content
 openssl dsa -pubin -in dsa_pub.pem -text -noout
 ==
 output
 pub:
 P:
 Q:
 G:
 ```
 
#### `ECDSA Public Keys`
 
 Relay on the ellipic curve division (ECD).  ECDSA keys are much smaller than RSA and DSA, and ECDSA predefined a list of params which could be used to generate keys. 
 
  `openssl ecparam`: handle ecparam and gen ec private keys.
  `openssl ec`: handle with ec keys
 
 Get list of predefined ec param 
 ```
 openssl ecparam -list_curves
 ==
 output
 secp112r1 : SECG/WTLS curve over a 112 bit prime field
  secp112r2 : SECG curve over a 112 bit prime field
  secp128r1 : SECG curve over a 128 bit prime field
  secp128r2 : SECG curve over a 128 bit prime field
  secp160k1 : SECG curve over a 160 bit prime field
  secp160r1 : SECG curve over a 160 bit prime field
  secp160r2 : SECG/WTLS curve over a 160 bit prime field
  secp192k1 : SECG curve over a 192 bit prime field
  secp224k1 : SECG curve over a 224 bit prime field
  secp224r1 : NIST/SECG curve over a 224 bit prime field
  secp256k1 : SECG curve over a 256 bit prime field
  secp384r1 : NIST/SECG curve over a 384 bit prime field
  secp521r1 : NIST/SECG curve over a 521 bit prime field
  prime192v1: NIST/X9.62/SECG curve over a 192 bit prime field
  prime192v2: X9.62 curve over a 192 bit prime field
  prime192v3: X9.62 curve over a 192 bit prime field
  prime239v1: X9.62 curve over a 239 bit prime field
  ...
 ```
 
 we could rely on those params to create ec params short name, choose `prime192v2` from above
 
 ```
 openssl ecparam -name prime192v2 -out ecparam.pem
 
 Check the content
 openssl ecparam -in ecparam.pem -text
 ==
 ASN1 OID: prime192v1
NIST CURVE: P-192
-----BEGIN EC PARAMETERS-----
BggqhkjOPQMBAQ==
-----END EC PARAMETERS-----
 ```
 
 Alternately, same with rsa, we can directly generate the private key by providing the params name
 
 ```
 openssl ecparam -name prime192v2 -genkey -noout -out ec_key.pem
 ```
 
Then we can use the ec param created above to create ec private key. the ec_key.pem like rsa and dsa key, are composed 
with params, public and private key. 

```
openssl ecparam -in ecparam.pem -genkey -noout -out ec_key.pem

extra contenxt

openssl ec -in ec_key.pem -text -noout
==
result

priv:
pub:
ASN1 OID:
NIST CURVE:

```

extract the public key from private key

```
openssl ec -in ec_key.pem -pubout -out ec_pub.pem

openssl ec -pubin -in ec_pub.pem -text -noout
==
pub:
ASN1 OID:
NIST CURVE:
```
## x509 certification 

The above private key and public key are pure private/public key, which could not be treated as x509 certificate. 
x509 certificate is composed with two parts

- public key
- User identify

## Certificate format
 
##
